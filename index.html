<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>VKernel 2.2.8 April Fools</title>
  <style>
    body {
      margin: 0;
      background: #000;
      color: #00ff88;
      font-family: 'Courier New', monospace;
      font-size: 16px;
    }
    #container {
      width: 100vw;
      height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 20px;
      box-sizing: border-box;
    }
    #terminal {
      flex: 1;
      overflow-y: auto;
      white-space: pre-wrap;
      padding-bottom: 10px;
    }
    #input-line {
      display: flex;
    }
    #input {
      background: transparent;
      border: none;
      color: #00ff88;
      font-family: inherit;
      font-size: 16px;
      outline: none;
      flex: 1;
    }
    .prompt {
      margin-right: 5px;
    }
    .banner {
      color: #00ffff;
      text-align: center;
      font-weight: bold;
      padding-bottom: 10px;
    }
  </style>
</head>
<body>
  <div id="container">
    <div class="banner">Welcome to VKernel 2.2.8 April Fools</div>
    <div id="terminal"></div>
    <div id="input-line">
      <span class="prompt">$</span>
      <input id="input" autofocus autocomplete="off" />
    </div>
  </div>
  <script>
    const terminal = document.getElementById("terminal");
    const input = document.getElementById("input");

    let fileSystem = {
      '/': ['home', 'bin', 'tmp', 'var', 'etc'],
      '/home': ['user'],
      '/home/user': ['file.txt'],
      '/tmp': [],
      '/var': [],
      '/etc': [],
      '/bin': ['ls', 'echo', 'cat', 'touch']
    };
    let currentDir = '/';
    let history = [];
    let files = {
      '/home/user/file.txt': 'Hello from VKernel!'
    };

    function resolvePath(path) {
      if (!path || path === '.') return currentDir;
      if (path === '..') {
        return currentDir === '/' ? '/' : currentDir.split('/').slice(0, -1).join('/') || '/';
      }
      if (path.startsWith('/')) return path;
      return currentDir === '/' ? '/' + path : currentDir + '/' + path;
    }

    const commands = {
      help: () => {
        const cmds = Object.keys(commands).sort();
        const columns = 4;
        const rows = Math.ceil(cmds.length / columns);
        let output = '';
        for (let i = 0; i < rows; i++) {
          let row = '';
          for (let j = 0; j < columns; j++) {
            const cmd = cmds[i + j * rows];
            if (cmd) row += cmd.padEnd(18, ' ');
          }
          output += row + '\n';
        }
        return output;
      },
      ls: () => (fileSystem[currentDir] || []).join('  '),
      pwd: () => currentDir,
      cd: (args) => {
        const path = resolvePath(args[0]);
        if (fileSystem[path]) {
          currentDir = path;
          return '';
        }
        return 'No such directory';
      },
      mkdir: (args) => {
        const path = resolvePath(args[0]);
        const parent = path.substring(0, path.lastIndexOf('/')) || '/';
        const name = path.split('/').pop();
        if (!fileSystem[parent]) return 'Parent directory not found';
        fileSystem[path] = [];
        fileSystem[parent].push(name);
        return '';
      },
      touch: (args) => {
        const path = resolvePath(args[0]);
        const dir = path.substring(0, path.lastIndexOf('/')) || '/';
        const name = path.split('/').pop();
        if (!fileSystem[dir]) return 'Directory not found';
        fileSystem[dir].push(name);
        files[path] = '';
        return '';
      },
      echo: (args) => args.join(' '),
      cat: (args) => files[resolvePath(args[0])] ?? 'No such file',
      clear: () => {
        terminal.innerHTML = '';
        return '';
      },
      whoami: () => 'user',
      date: () => new Date().toString(),
      uname: () => 'VKernel 2.2.8-AprilFools x86_64',
      cal: () => '   April 2025\nSu Mo Tu We Th Fr Sa\n       1  2  3  4  5\n 6  7  8  9 10 11 12\n13 14 15 16 17 18 19\n20 21 22 23 24 25 26\n27 28 29 30',
      exit: () => 'Session closed.',
      history: () => history.join('\n'),
      uptime: () => 'up 1 hour, 2 users, load average: 0.00, 0.01, 0.05',
      hostname: () => 'vkernel-host',
      free: () => 'Mem: 1024 total, 512 used, 512 free',
      df: () => 'Filesystem Size Used Avail Use% Mounted on\nrootfs 100M 50M 50M 50% /',
      ps: () => 'PID TTY TIME CMD\n1 ? 00:00:00 init\n2 ? 00:00:00 bash',
      kill: (args) => `Process ${args[0]} terminated.`,
      top: () => 'PID  USER  CPU  MEM  COMMAND\n1    root  0.0  0.1  init\n2    user  0.1  0.2  bash',
      man: () => 'Use "help" to list commands.',
      chmod: () => 'Permissions changed',
      chown: () => 'Owner changed',
      rm: (args) => {
        const path = resolvePath(args[0]);
        const dir = path.substring(0, path.lastIndexOf('/')) || '/';
        const name = path.split('/').pop();
        if (fileSystem[dir]) {
          fileSystem[dir] = fileSystem[dir].filter(f => f !== name);
          delete files[path];
          delete fileSystem[path];
          return '';
        }
        return 'File not found';
      },
      mv: (args) => {
        const oldPath = resolvePath(args[0]);
        const newPath = resolvePath(args[1]);
        if (!files[oldPath]) return 'Source file not found';
        files[newPath] = files[oldPath];
        delete files[oldPath];
        return '';
      },
      cp: (args) => {
        const src = resolvePath(args[0]);
        const dest = resolvePath(args[1]);
        if (!files[src]) return 'Source file not found';
        files[dest] = files[src];
        return '';
      },
      grep: (args) => {
        const word = args[0];
        const path = resolvePath(args[1]);
        const content = files[path];
        return content.split('\n').filter(line => line.includes(word)).join('\n');
      },
      head: (args) => {
        const path = resolvePath(args[0]);
        return files[path]?.split('\n').slice(0, 10).join('\n') ?? 'No such file';
      },
      tail: (args) => {
        const path = resolvePath(args[0]);
        return files[path]?.split('\n').slice(-10).join('\n') ?? 'No such file';
      },
      wc: (args) => {
        const path = resolvePath(args[0]);
        const content = files[path];
        if (!content) return 'No such file';
        const lines = content.split('\n').length;
        const words = content.split(/\s+/).length;
        const chars = content.length;
        return `${lines} ${words} ${chars}`;
      },
      basename: (args) => args[0].split('/').pop(),
      dirname: (args) => args[0].split('/').slice(0, -1).join('/') || '/',
      expr: (args) => eval(args.join(' ')).toString(),
      test: () => 'true',
      sleep: () => 'Sleeping...',
      id: () => 'uid=1000(user) gid=1000(user)',
      env: () => 'HOME=/home/user\nSHELL=/bin/bash',
      export: () => 'Environment variable set',
      unset: () => 'Environment variable removed',
      alias: () => 'alias ll="ls -l"',
      unalias: () => 'unalias ll',
      type: (args) => `${args[0]} is a shell builtin`,
      which: (args) => `/bin/${args[0]}`,
      whereis: (args) => `/bin/${args[0]}`,
      yes: () => 'y\ny\ny\ny\ny\ny\ny',
      false: () => '',
      true: () => ''
    };

    function runCommand(text) {
      terminal.innerHTML += `\n$ ${text}`;
      history.push(text);
      const parts = text.trim().split(/\s+/);
      const cmd = parts[0];
      const args = parts.slice(1);
      if (commands[cmd]) {
        const result = commands[cmd](args);
        if (result !== '') terminal.innerHTML += `\n${result}`;
      } else {
        terminal.innerHTML += `\n${cmd}: command not found`;
      }
      terminal.scrollTop = terminal.scrollHeight;
    }

    input.addEventListener("keydown", function (e) {
      if (e.key === "Enter") {
        const val = input.value;
        runCommand(val);
        input.value = '';
      }
    });

    runCommand('help');
  </script>
</body>
</html>
